<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi ç™»å½•</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
    <h2>è«‹é»æ“ŠæŒ‰éˆ•ç™»å…¥ Pi Network</h2>
    <button onclick="login()">Pi ç™»å½•</button>

    <script>
        async function login() {
            try {
                // é€²è¡Œ Pi Network èº«ä»½é©—è­‰
                const authResult = await Pi.authenticate(['username', 'wallet_address'], onIncompletePaymentFound);
                console.log("âœ… Pi ç™»å½•æˆåŠŸ:", authResult);

                // å–å¾—ç™»å…¥è³‡è¨Š
                const accessToken = authResult.accessToken;
                const username = authResult.user.username;

                console.log("ğŸ¯ å›å‚³çµ¦ Unity:", accessToken, username);

                // âœ… é€é Unity WebGL SendMessage å›å‚³ç™»å…¥è³‡è¨Š
                if (typeof unityInstance !== "undefined") {
                    unityInstance.SendMessage("PiLoginHandler", "OnPiLoginSuccess", `${accessToken}|${username}`);
                }
            } catch (error) {
                console.error("âŒ ç™»å½•å¤±è´¥:", error);
                alert("ç™»å½•å¤±è´¥ï¼š" + error.message);
            }
        }

        function onIncompletePaymentFound(payment) {
            console.warn("âš ï¸ æœªå®Œæˆçš„ä»˜æ¬¾äº¤æ˜“:", payment);
        }
    </script>
</body>
</html>
